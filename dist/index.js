import{jsx as n,jsxs as t}from"react/jsx-runtime";import{createContext as r,useRef as o,useReducer as e,useEffect as i,useCallback as a}from"react";var u=function(){return u=Object.assign||function(n){for(var t,r=1,o=arguments.length;r<o;r++)for(var e in t=arguments[r])Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n},u.apply(this,arguments)};var l="activemodalupdate",c=new Event(l),d=function(){dispatchEvent(c)},v=[],f=function(){return v},s=function(){var n;return null!==(n=v.at(-2))&&void 0!==n?n:null},p=function(n){var t;return(null===(t=f().at(-1))||void 0===t?void 0:t._sid)===n},w=function(n){return!!v.find((function(t){return t._sid===n}))},m=function(n){w(n._sid)||v.push(n)},h=function(){v.pop()},y=function(n,t){if(n||t){var r=g(n,t),o=r.data,e=r.url;window.history.pushState(o,"",e)}};function g(n,t,r){void 0===r&&(r=!1);var o,e,i,a,l=new URLSearchParams(window.location.search);return n&&(l=function(n,t){for(var r in n.delete("modal"),t.params)n.delete(r);return n}(l,n)),t&&!r&&(l=function(n,t){var r=u({modal:t.id},t.params);for(var o in r)n.append(o,r[o].toString());return n}(l,t)),{url:(o=l,e=window.location.pathname.toString(),i=o.toString()?"?"+o.toString():"",a=window.location.hash.toString()?"#"+window.location.hash.toString():"",""+e+i+a),data:{modals:f()}}}var O=function(n){var t;if(p(n)){var r=null!==(t=v.at(-1))&&void 0!==t?t:null,o=s();h(),y(r,o),d()}},S=function(){var n,t,r=null!==(n=window.history.state.modals)&&void 0!==n?n:[],o=f();if(1===Math.abs(r.length-o.length)){var e=Math.min(r.length,o.length),i=null!==(t=r.slice(e).at(-1))&&void 0!==t?t:null;i?m(i):h()}d()},b=function(){var n=function(){var n=new URLSearchParams(window.location.search),t=Object.fromEntries(n.entries()),r=t.modal,o=function(n,t){var r={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&t.indexOf(o)<0&&(r[o]=n[o]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(o=Object.getOwnPropertySymbols(n);e<o.length;e++)t.indexOf(o[e])<0&&Object.prototype.propertyIsEnumerable.call(n,o[e])&&(r[o[e]]=n[o[e]])}return r}(t,["modal"]);if(!r)return null;return{id:"".concat(r),params:o,_sid:E()}}();n&&(m(n),function(n,t){if(n||t){var r=g(n,t,!0),o=r.data,e=r.url;window.history.replaceState(u(u({},window.history.state),o),"",e)}}(null,n),d())};function E(){return Math.floor(1e6*Math.random())}var j={},L=function(n,t){j[n]=t},P=r(void 0),_=function(r){var a=r.children,c=o(!1),d=e((function(n){return n+1}),0)[1],v=f();i((function(){return window.addEventListener(l,d),window.addEventListener("popstate",S),function(){window.removeEventListener(l,d),window.removeEventListener("popstate",S)}}),[]),i((function(){c.current||(b(),c.current=!0)}),[]);var s=v.map((function(t,r){var o=function(n){var t;return null!==(t=j[n])&&void 0!==t?t:null}(t.id);if(!o)return null;return n(o,{close:function(){var n;O(t._sid),null===(n=t.onClose)||void 0===n||n.call(t)},params:t.params},r)}));return t(P.Provider,u({value:void 0},{children:[a,s]}))},x=function(n){var t=e((function(n){return n+1}),0)[1],r=o(E());return i((function(){return window.addEventListener("activemodalupdate",t),function(){window.removeEventListener("activemodalupdate",t)}}),[]),{open:a((function(t){!function(n){m(n),y(s(),n),d()}({id:n,params:null==t?void 0:t.params,onClose:null==t?void 0:t.onClose,_sid:r.current})}),[n]),closeActive:a((function(){O(r.current)}),[]),isActive:p(r.current),isOpened:w(r.current)}};export{_ as ModalsProvider,L as registerModal,x as useModal};
//# sourceMappingURL=index.js.map
