import{jsx as n,Fragment as t}from"react/jsx-runtime";import{useState as r,useEffect as e,useRef as o,useReducer as i}from"react";var u=function(){return u=Object.assign||function(n){for(var t,r=1,e=arguments.length;r<e;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},u.apply(this,arguments)};var a=function(o){var i=o.children,u=o.isOpened,a=r(!1),c=a[0],l=a[1];return e((function(){return setTimeout((function(){return l(u)})),function(){l(!1)}}),[u]),n(t,{children:i(c)})},c=[],l=function(){return c},d=function(){var n;return null!==(n=c.at(-1))&&void 0!==n?n:null},f=function(n){var t;return(null===(t=d())||void 0===t?void 0:t.id)===n},s=function(n){c.push(n)},v=function(){c.pop()},p=function(n,t){if(n||t){var r=w(n,t),e=r.data,o=r.url;window.history.pushState(e,"",o)}};function w(n,t,r){void 0===r&&(r=!1);var e,o,i,a,c=new URLSearchParams(window.location.search);return n&&(c=function(n,t){for(var r in n.delete("modal"),t.params)n.delete(r);return n}(c,n)),t&&!r&&(c=function(n,t){var r=u({modal:t.id},t.params);for(var e in r)n.append(e,r[e].toString());return n}(c,t)),{url:(e=c,o=window.location.pathname.toString(),i=e.toString()?"?"+e.toString():"",a=window.location.hash.toString()?"#"+window.location.hash.toString():"",""+o+i+a),data:{modals:l()}}}var m=function(){var n=new URLSearchParams(window.location.search),t=Object.fromEntries(n.entries()),r=t.modal,e=function(n,t){var r={};for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&t.indexOf(e)<0&&(r[e]=n[e]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(e=Object.getOwnPropertySymbols(n);o<e.length;o++)t.indexOf(e[o])<0&&Object.prototype.propertyIsEnumerable.call(n,e[o])&&(r[e[o]]=n[e[o]])}return r}(t,["modal"]);return r?{id:"".concat(r),params:e}:null},h="modalrouterevent",O=new Event(h),g=function(){return dispatchEvent(O)},y=function(n){var t;if(f(n)){var r=d(),e=null!==(t=c.at(-2))&&void 0!==t?t:null;v(),p(r,e),g()}},S=function(){var n,t=function(){var n;return null!==(n=window.history.state.modals)&&void 0!==n?n:[]}(),r=l(),e=Math.min(t.length,r.length),o=null!==(n=t.slice(e).at(-1))&&void 0!==n?n:null;o?s(o):v(),g()},b=function(){var n=m();n&&(s(n),function(n,t){if(n||t){var r=w(n,t,!0),e=r.data,o=r.url;window.history.replaceState(u(u({},window.history.state),e),"",o)}}(null,n),g())},E={},j=function(n,t){return E[n]=t,{open:function(t){return r={id:n,params:null!=t?t:{}},e=d(),s(r),p(e,r),void g();var r,e},close:function(){return y(n)},getIsActive:function(){return f(n)},getIsOpened:function(){return t=n,!!c.find((function(n){return n.id===t}));var t}}},L=function(){var r=o(!1),c=i((function(n){return n+1}),0)[1];e((function(){var n=function(){return c()};return window.addEventListener(h,n),window.addEventListener("popstate",S),r.current||(r.current=!0,b()),function(){window.removeEventListener(h,n),window.removeEventListener("popstate",S)}}),[]);var d=Object.keys(E),s=l(),v=d.map((function(t){var r=function(n){var t;return null!==(t=E[n])&&void 0!==t?t:null}(t);if(!r)return null;var e=s.find((function(n){return n.id===t}));if(!e)return null;var o=f(e.id);return n(a,u({isOpened:o},{children:function(t){return n(r,{close:function(){return y(e.id)},isOpened:t,params:e.params})}}),e.id)}));return n(t,{children:v})},P=function(n){var t=i((function(n){return n+1}),0)[1];return e((function(){var n=function(){return t()};return window.addEventListener(h,n),function(){window.addEventListener(h,n)}}),[]),{open:n.open,close:n.close,isActive:n.getIsActive(),isOpened:n.getIsOpened()}};export{L as ModalsProvider,j as registerModal,P as useModal};
//# sourceMappingURL=index.js.map
