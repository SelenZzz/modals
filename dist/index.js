import{jsx as n,jsxs as t}from"react/jsx-runtime";import{createContext as r,useRef as o,useReducer as e,useEffect as a}from"react";var i=function(){return i=Object.assign||function(n){for(var t,r=1,o=arguments.length;r<o;r++)for(var e in t=arguments[r])Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n},i.apply(this,arguments)};var u=new Event("activemodalupdate"),l=function(){dispatchEvent(u)},c=[],d=function(){return c},f=function(n){c.push(n)};function s(n,t){var r,o,e,a,u=new URLSearchParams(window.location.search);return n&&(u=function(n,t){for(var r in n.delete("modal"),t.params)n.delete(r);return n}(u,n)),t&&(u=function(n,t){var r=i({modal:t.id},t.params);for(var o in r)n.append(o,r[o].toString());return n}(u,t)),{url:(r=u,o=window.location.pathname.toString(),e=r.toString()?"?"+r.toString():"",a=window.location.hash.toString()?"#"+window.location.hash.toString():"",""+o+e+a),data:{modals:d()}}}var v=function(n){var t;f(n),function(n,t){if(n||t){var r=s(n,t),o=r.data,e=r.url;window.history.pushState(o,"",e)}}(null!==(t=c.at(-2))&&void 0!==t?t:null,n),l()},p=function(){window.history.back()},w=function(){var n,t,r=null!==(n=window.history.state.modals)&&void 0!==n?n:[],o=d();if(1===Math.abs(r.length-o.length)){var e=Math.min(r.length,o.length),a=null!==(t=r.slice(e).at(-1))&&void 0!==t?t:null;a?f(a):c.pop()}l()},h=function(){var n=function(){var n=new URLSearchParams(window.location.search),t=Object.fromEntries(n.entries()),r=t.modal,o=function(n,t){var r={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&t.indexOf(o)<0&&(r[o]=n[o]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(o=Object.getOwnPropertySymbols(n);e<o.length;e++)t.indexOf(o[e])<0&&Object.prototype.propertyIsEnumerable.call(n,o[e])&&(r[o[e]]=n[o[e]])}return r}(t,["modal"]);if(!r)return null;return{id:"".concat(r),params:o}}();n&&(f(n),function(n,t){if(n||t){var r=s(n,t),o=r.data,e=r.url;window.history.replaceState(i(i({},window.history.state),{data:o}),"",e)}}(null,n),l())};var m={},y=function(n,t){m[n]=t},g=r(void 0),O=function(r){var u=r.children,l=o(!1),c=e((function(n){return n+1}),0)[1],f=d();a((function(){return window.addEventListener("activemodalupdate",c),window.addEventListener("popstate",w),function(){window.removeEventListener("activemodalupdate",c),window.removeEventListener("popstate",w)}}),[]),a((function(){l.current||(h(),l.current=!0)}),[]);var s=f.map((function(t,r){var o=function(n){var t;return null!==(t=m[n])&&void 0!==t?t:null}(t.id);return o?n(o,{onClose:function(){return p()},params:t.params},r):null}));return t(g.Provider,i({value:void 0},{children:[u,s]}))};export{O as ModalsProvider,p as closeModal,h as init,v as openModal,y as registerModal};
//# sourceMappingURL=index.js.map
