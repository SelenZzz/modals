import{jsx as n,Fragment as t}from"react/jsx-runtime";import{useState as r,useEffect as i,createContext as o,useRef as e,useReducer as u,useCallback as a}from"react";var c=function(){return c=Object.assign||function(n){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},c.apply(this,arguments)};var l="activemodalupdate",d=new Event(l),f=function(){dispatchEvent(d)},s=[],v=function(){return s},p=function(){var n;return null!==(n=s.at(-2))&&void 0!==n?n:null},w=function(n){var t;return(null===(t=v().at(-1))||void 0===t?void 0:t._sid)===n},h=function(n){return!!s.find((function(t){return t._sid===n}))},m=function(n){h(n._sid)||s.push(n)},y=function(){s.pop()},g=function(n,t){if(n||t){var r=O(n,t),i=r.data,o=r.url;window.history.pushState(i,"",o)}};function O(n,t,r){void 0===r&&(r=!1);var i,o,e,u,a=new URLSearchParams(window.location.search);return n&&(a=function(n,t){for(var r in n.delete("modal"),t.params)n.delete(r);return n}(a,n)),t&&!r&&(a=function(n,t){var r=c({modal:t.id},t.params);for(var i in r)n.append(i,r[i].toString());return n}(a,t)),{url:(i=a,o=window.location.pathname.toString(),e=i.toString()?"?"+i.toString():"",u=window.location.hash.toString()?"#"+window.location.hash.toString():"",""+o+e+u),data:{modals:v()}}}var _={},b=function(n,t){_[n]=t},S=[],E=function(n,t){if(!S.find((function(n){return n._sid===t})))return S.push({id:n,_sid:t})},j=null,L=function(n){var t;if(w(n)){if(!(n!==j)){var r=null!==(t=s.at(-1))&&void 0!==t?t:null,i=p();return y(),g(r,i),void f()}window.history.back()}},P=function(){var n,t,r=null!==(n=window.history.state.modals)&&void 0!==n?n:[],i=v();if(1===Math.abs(r.length-i.length)){var o=Math.min(r.length,i.length),e=null!==(t=r.slice(o).at(-1))&&void 0!==t?t:null;e?m(e):y()}f()},x=function(){var n=function(){var n=new URLSearchParams(window.location.search),t=Object.fromEntries(n.entries()),r=t.modal,i=function(n,t){var r={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(r[i]=n[i]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(n);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(n,i[o])&&(r[i[o]]=n[i[o]])}return r}(t,["modal"]);if(!r)return null;return{id:"".concat(r),params:i,_sid:M()}}();n&&(m(n),E(n.id,n._sid),j=n._sid,function(n,t){if(n||t){var r=O(n,t,!0),i=r.data,o=r.url;window.history.replaceState(c(c({},window.history.state),i),"",o)}}(null,n),f())};function M(){return Math.floor(1e6*Math.random())}var C=function(o){var e=o.children,u=o.opened,a=r(!1),c=a[0],l=a[1];return i((function(){return setTimeout((function(){return l(u)})),function(){l(!1)}}),[u]),n(t,{children:e(c)})},A=o(void 0),R=function(){var t=e(!1),r=u((function(n){return n+1}),0)[1],o=v();i((function(){return window.addEventListener(l,r),window.addEventListener("popstate",P),function(){window.removeEventListener(l,r),window.removeEventListener("popstate",P)}}),[]),i((function(){t.current||(x(),t.current=!0)}),[]);var a=S.map((function(t){var r=function(n){var t;return null!==(t=_[n])&&void 0!==t?t:null}(t.id);if(!r)return null;var i=o.find((function(n){return n._sid===t._sid})),e=function(){var n;L(t._sid),null===(n=null==i?void 0:i.onClose)||void 0===n||n.call(i)};return n(C,c({opened:!!i},{children:function(t){return n(r,{close:e,opened:t,params:null==i?void 0:i.params})}}),t._sid)}));return n(A.Provider,c({value:void 0},{children:a}))},U=function(n){var t=u((function(n){return n+1}),0)[1],r=e(M());return i((function(){var i=r.current;return E(n,i),window.addEventListener(l,t),function(){!function(n){S.filter((function(t){return t._sid!==n}))}(i),window.removeEventListener(l,t)}}),[]),{open:a((function(t){!function(n){m(n),g(p(),n),f()}({id:n,params:null==t?void 0:t.params,onClose:null==t?void 0:t.onClose,_sid:r.current})}),[n]),closeActive:a((function(){L(r.current)}),[]),isActive:w(r.current),isOpened:h(r.current)}};export{R as ModalsProvider,b as registerModal,U as useModal};
//# sourceMappingURL=index.js.map
