import{jsx as n,jsxs as t}from"react/jsx-runtime";import{createContext as r,useRef as o,useReducer as e,useEffect as i,useCallback as a}from"react";var u=function(){return u=Object.assign||function(n){for(var t,r=1,o=arguments.length;r<o;r++)for(var e in t=arguments[r])Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n},u.apply(this,arguments)};var c=new Event("activemodalupdate"),l=function(){dispatchEvent(c)},d=[],s=function(){return d},f=function(n){return!!d.findLast((function(t){return t._sid===n}))},v=function(n){f(n._sid)||d.push(n)};function p(n,t){var r,o,e,i,a=new URLSearchParams(window.location.search);return n&&(a=function(n,t){for(var r in n.delete("modal"),t.params)n.delete(r);return n}(a,n)),t&&(a=function(n,t){var r=u({modal:t.id},t.params);for(var o in r)n.append(o,r[o].toString());return n}(a,t)),{url:(r=a,o=window.location.pathname.toString(),e=r.toString()?"?"+r.toString():"",i=window.location.hash.toString()?"#"+window.location.hash.toString():"",""+o+e+i),data:{modals:s()}}}var w=function(n){var t;v(n),function(n,t){if(n||t){var r=p(n,t),o=r.data,e=r.url;window.history.pushState(o,"",e)}}(null!==(t=d.at(-2))&&void 0!==t?t:null,n),l()},m=function(){window.history.back()},h=function(){var n,t,r=null!==(n=window.history.state.modals)&&void 0!==n?n:[],o=s();if(1===Math.abs(r.length-o.length)){var e=Math.min(r.length,o.length),i=null!==(t=r.slice(e).at(-1))&&void 0!==t?t:null;i?v(i):d.pop()}l()},y=function(){var n=function(){var n=new URLSearchParams(window.location.search),t=Object.fromEntries(n.entries()),r=t.modal,o=function(n,t){var r={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&t.indexOf(o)<0&&(r[o]=n[o]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(o=Object.getOwnPropertySymbols(n);e<o.length;e++)t.indexOf(o[e])<0&&Object.prototype.propertyIsEnumerable.call(n,o[e])&&(r[o[e]]=n[o[e]])}return r}(t,["modal"]);if(!r)return null;return{id:"".concat(r),params:o,_sid:g()}}();n&&(v(n),function(n,t){if(n||t){var r=p(n,t),o=r.data,e=r.url;window.history.replaceState(u(u({},window.history.state),{data:o}),"",e)}}(null,n),l())};function g(){return Math.floor(1e6*Math.random())}var O={},b=function(n,t){O[n]=t},S=r(void 0),j=function(r){var a=r.children,c=o(!1),l=e((function(n){return n+1}),0)[1],d=s();i((function(){return window.addEventListener("activemodalupdate",l),window.addEventListener("popstate",h),function(){window.removeEventListener("activemodalupdate",l),window.removeEventListener("popstate",h)}}),[]),i((function(){c.current||(y(),c.current=!0)}),[]);var f=d.map((function(t,r){var o=function(n){var t;return null!==(t=O[n])&&void 0!==t?t:null}(t.id);return o?n(o,{onClose:function(){return m()},params:t.params},r):null}));return t(S.Provider,u({value:void 0},{children:[a,f]}))},E=function(n){var t=o(g());return{open:a((function(r){var o={id:n,params:null==r?void 0:r.params,onClose:null==r?void 0:r.onClose,_sid:t.current};w(o)}),[n]),closeActive:a((function(){m()}),[]),isActive:a((function(){return n=t.current,(null===(r=s().at(-1))||void 0===r?void 0:r._sid)===n;var n,r}),[]),isOpened:a((function(){return f(t.current)}),[])}};export{j as ModalsProvider,m as closeModal,y as init,w as openModal,b as registerModal,E as useModal};
//# sourceMappingURL=index.js.map
