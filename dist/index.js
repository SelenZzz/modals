import{jsx as n,jsxs as t}from"react/jsx-runtime";import{createContext as r,useRef as o,useReducer as e,useEffect as i,useCallback as a}from"react";var u=function(){return u=Object.assign||function(n){for(var t,r=1,o=arguments.length;r<o;r++)for(var e in t=arguments[r])Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n},u.apply(this,arguments)};var c=new Event("activemodalupdate"),l=function(){dispatchEvent(c)},d=[],s=function(){return d},v=function(n){var t;return(null===(t=s().at(-1))||void 0===t?void 0:t._sid)===n},f=function(n){return!!d.find((function(t){return t._sid===n}))},p=function(n){f(n._sid)||d.push(n)};function w(n,t){var r,o,e,i,a=new URLSearchParams(window.location.search);return n&&(a=function(n,t){for(var r in n.delete("modal"),t.params)n.delete(r);return n}(a,n)),t&&(a=function(n,t){var r=u({modal:t.id},t.params);for(var o in r)n.append(o,r[o].toString());return n}(a,t)),{url:(r=a,o=window.location.pathname.toString(),e=r.toString()?"?"+r.toString():"",i=window.location.hash.toString()?"#"+window.location.hash.toString():"",""+o+e+i),data:{modals:s()}}}var m=function(n){var t;p(n),function(n,t){if(n||t){var r=w(n,t),o=r.data,e=r.url;window.history.pushState(o,"",e)}}(null!==(t=d.at(-2))&&void 0!==t?t:null,n),l()},h=function(n){v(n)&&window.history.back()},y=function(){var n,t,r=null!==(n=window.history.state.modals)&&void 0!==n?n:[],o=s();if(1===Math.abs(r.length-o.length)){var e=Math.min(r.length,o.length),i=null!==(t=r.slice(e).at(-1))&&void 0!==t?t:null;i?p(i):d.pop()}l()},g=function(){var n=function(){var n=new URLSearchParams(window.location.search),t=Object.fromEntries(n.entries()),r=t.modal,o=function(n,t){var r={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&t.indexOf(o)<0&&(r[o]=n[o]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(o=Object.getOwnPropertySymbols(n);e<o.length;e++)t.indexOf(o[e])<0&&Object.prototype.propertyIsEnumerable.call(n,o[e])&&(r[o[e]]=n[o[e]])}return r}(t,["modal"]);if(!r)return null;return{id:"".concat(r),params:o,_sid:O()}}();n&&(p(n),function(n,t){if(n||t){var r=w(n,t),o=r.data,e=r.url;window.history.replaceState(u(u({},window.history.state),{data:o}),"",e)}}(null,n),l())};function O(){return Math.floor(1e6*Math.random())}var b={},S=function(n,t){b[n]=t},E=r(void 0),j=function(r){var a=r.children,c=o(!1),l=e((function(n){return n+1}),0)[1],d=s();i((function(){return window.addEventListener("activemodalupdate",l),window.addEventListener("popstate",y),function(){window.removeEventListener("activemodalupdate",l),window.removeEventListener("popstate",y)}}),[]),i((function(){c.current||(g(),c.current=!0)}),[]);var v=d.map((function(t,r){var o=function(n){var t;return null!==(t=b[n])&&void 0!==t?t:null}(t.id);return o?n(o,{onClose:function(){return h()},params:t.params},r):null}));return t(E.Provider,u({value:void 0},{children:[a,v]}))},L=function(n){var t=e((function(n){return n+1}),0)[1],r=o(O());return i((function(){return window.addEventListener("activemodalupdate",t),function(){window.removeEventListener("activemodalupdate",t)}}),[]),{open:a((function(t){var o={id:n,params:null==t?void 0:t.params,onClose:null==t?void 0:t.onClose,_sid:r.current};m(o)}),[n]),closeActive:a((function(){h(r.current)}),[]),isActive:v(r.current),isOpened:f(r.current)}};export{j as ModalsProvider,h as closeModal,g as init,m as openModal,S as registerModal,L as useModal};
//# sourceMappingURL=index.js.map
