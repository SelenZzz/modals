import{jsx as n}from"react/jsx-runtime";import{memo as t,useState as r,useEffect as e,useRef as o,useReducer as i}from"react";var a=[],u=function(){return a},c=function(){var n;return null!==(n=a.at(-1))&&void 0!==n?n:null},l=function(n){var t;return(null===(t=c())||void 0===t?void 0:t.id)===n},d=function(n){a.push(n)},v=function(){a.pop()},f=function(){return f=Object.assign||function(n){for(var t,r=1,e=arguments.length;r<e;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},f.apply(this,arguments)};var s=function(n,t){if(n||t){var r=p(n,t),e=r.data,o=r.url;window.history.pushState(e,"",o)}};function p(n,t,r){void 0===r&&(r=!1);var e,o,i,a,c=new URLSearchParams(window.location.search);return n&&(c=function(n,t){for(var r in n.delete("modal"),t.params)n.delete(r);return n}(c,n)),t&&!r&&(c=function(n,t){var r=f({modal:t.id},t.params);for(var e in r)n.append(e,r[e].toString());return n}(c,t)),{url:(e=c,o=window.location.pathname.toString(),i=e.toString()?"?"+e.toString():"",a=window.location.hash.toString()?"#"+window.location.hash.toString():"",""+o+i+a),data:{modals:u()}}}var w=function(){var n=new URLSearchParams(window.location.search),t=Object.fromEntries(n.entries()),r=t.modal,e=function(n,t){var r={};for(var e in n)Object.prototype.hasOwnProperty.call(n,e)&&t.indexOf(e)<0&&(r[e]=n[e]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(e=Object.getOwnPropertySymbols(n);o<e.length;o++)t.indexOf(e[o])<0&&Object.prototype.propertyIsEnumerable.call(n,e[o])&&(r[e[o]]=n[e[o]])}return r}(t,["modal"]);return r?{id:"".concat(r),params:e}:null},m="modalrouterevent",h=new Event(m),y=function(){return dispatchEvent(h)},O=function(n){var t;if(l(n)){var r=c(),e=null!==(t=a.at(-2))&&void 0!==t?t:null;v(),s(r,e),y()}},g=function(){var n,t=function(){var n;return null!==(n=window.history.state.modals)&&void 0!==n?n:[]}(),r=u(),e=Math.min(t.length,r.length),o=null!==(n=t.slice(e).at(-1))&&void 0!==n?n:null;o?d(o):v(),y()},S=function(){var n=w();n&&(d(n),function(n,t){if(n||t){var r=p(n,t,!0),e=r.data,o=r.url;window.history.replaceState(f(f({},window.history.state),e),"",o)}}(null,n),y())},b={},E=function(n,t){return b[n]=t,{open:function(t){return r={id:n,params:null!=t?t:{}},e=c(),d(r),s(e,r),void y();var r,e},close:function(){return O(n)},getIsActive:function(){return l(n)},getIsOpened:function(){return t=n,!!a.find((function(n){return n.id===t}));var t}}},j=t((function(t){var o,i,a=t.modalId,c=t.isActive,d=r(!1),v=d[0],f=d[1];if(e((function(){c?f(!0):v&&setTimeout((function(){l(a)||f(!1)}),2e3)}),[c]),!v&&!c)return null;var s=function(n){var t;return null!==(t=b[n])&&void 0!==t?t:null}(a);if(!s)return null;var p=null!==(i=null===(o=u().find((function(n){return n.id===a})))||void 0===o?void 0:o.params)&&void 0!==i?i:{};return n(s,{close:function(){return O(a)},isOpened:c&&v,params:p})}));j.displayName="ModalContainer";var L=function(){var t=o(!1),r=i((function(n){return n+1}),0)[1];e((function(){var n=function(){return r()};return window.addEventListener(m,n),window.addEventListener("popstate",g),t.current||(t.current=!0,S()),function(){window.removeEventListener(m,n),window.removeEventListener("popstate",g)}}),[]);var a=Object.keys(b).map((function(t){var r=l(t);return n(j,{modalId:t,isActive:r},t)}));return n("div",{children:a})},I=function(n){var t=i((function(n){return n+1}),0)[1];return e((function(){var n=function(){return t()};return window.addEventListener(m,n),function(){window.addEventListener(m,n)}}),[]),{open:n.open,close:n.close,isActive:n.getIsActive(),isOpened:n.getIsOpened()}};export{L as ModalsProvider,E as registerModal,I as useModal};
//# sourceMappingURL=index.js.map
