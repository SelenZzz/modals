import{jsx as n,jsxs as t}from"react/jsx-runtime";import{createContext as r,useRef as o,useReducer as e,useEffect as i,useCallback as a}from"react";var u=function(){return u=Object.assign||function(n){for(var t,r=1,o=arguments.length;r<o;r++)for(var e in t=arguments[r])Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n},u.apply(this,arguments)};var c="activemodalupdate",l=new Event(c),d=function(){dispatchEvent(l)},s=[],v=function(){return s},f=function(n){var t;return(null===(t=v().at(-1))||void 0===t?void 0:t._sid)===n},p=function(n){return!!s.find((function(t){return t._sid===n}))},w=function(n){p(n._sid)||s.push(n)};function m(n,t){var r,o,e,i,a=new URLSearchParams(window.location.search);return n&&(a=function(n,t){for(var r in n.delete("modal"),t.params)n.delete(r);return n}(a,n)),t&&(a=function(n,t){var r=u({modal:t.id},t.params);for(var o in r)n.append(o,r[o].toString());return n}(a,t)),{url:(r=a,o=window.location.pathname.toString(),e=r.toString()?"?"+r.toString():"",i=window.location.hash.toString()?"#"+window.location.hash.toString():"",""+o+e+i),data:{modals:v()}}}var h=function(n){var t;w(n),function(n,t){if(n||t){var r=m(n,t),o=r.data,e=r.url;window.history.pushState(o,"",e)}}(null!==(t=s.at(-2))&&void 0!==t?t:null,n),d()},y=function(n){f(n)&&window.history.back()},g=function(){var n,t,r=null!==(n=window.history.state.modals)&&void 0!==n?n:[],o=v();if(1===Math.abs(r.length-o.length)){var e=Math.min(r.length,o.length),i=null!==(t=r.slice(e).at(-1))&&void 0!==t?t:null;i?w(i):s.pop()}d()},O=function(){var n=function(){var n=new URLSearchParams(window.location.search),t=Object.fromEntries(n.entries()),r=t.modal,o=function(n,t){var r={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&t.indexOf(o)<0&&(r[o]=n[o]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(o=Object.getOwnPropertySymbols(n);e<o.length;e++)t.indexOf(o[e])<0&&Object.prototype.propertyIsEnumerable.call(n,o[e])&&(r[o[e]]=n[o[e]])}return r}(t,["modal"]);if(!r)return null;return{id:"".concat(r),params:o,_sid:b()}}();n&&(w(n),function(n,t){if(n||t){var r=m(n,t),o=r.data,e=r.url;window.history.replaceState(u(u({},window.history.state),{data:o}),"",e)}}(null,n),d())};function b(){return Math.floor(1e6*Math.random())}var S={},E=function(n,t){S[n]=t},j=r(void 0),L=function(r){var a=r.children,l=o(!1),d=e((function(n){return n+1}),0)[1],s=v();i((function(){return window.addEventListener(c,d),window.addEventListener("popstate",g),function(){window.removeEventListener(c,d),window.removeEventListener("popstate",g)}}),[]),i((function(){l.current||(O(),l.current=!0)}),[]);var f=s.map((function(t,r){var o=function(n){var t;return null!==(t=S[n])&&void 0!==t?t:null}(t.id);if(!o)return null;return n(o,{close:function(){var n;y(t._sid),null===(n=t.onClose)||void 0===n||n.call(t)},params:t.params},r)}));return t(j.Provider,u({value:void 0},{children:[a,f]}))},P=function(n){var t=e((function(n){return n+1}),0)[1],r=o(b());return i((function(){return window.addEventListener("activemodalupdate",t),function(){window.removeEventListener("activemodalupdate",t)}}),[]),{open:a((function(t){var o={id:n,params:null==t?void 0:t.params,onClose:null==t?void 0:t.onClose,_sid:r.current};h(o)}),[n]),closeActive:a((function(){y(r.current)}),[]),isActive:f(r.current),isOpened:p(r.current)}};export{L as ModalsProvider,E as registerModal,P as useModal};
//# sourceMappingURL=index.js.map
