import{jsx as n}from"react/jsx-runtime";import{createContext as t,useRef as r,useReducer as i,useEffect as o,useCallback as e}from"react";var a=function(){return a=Object.assign||function(n){for(var t,r=1,i=arguments.length;r<i;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(n[o]=t[o]);return n},a.apply(this,arguments)};var u="activemodalupdate",l=new Event(u),c=function(){dispatchEvent(l)},d=[],f=function(){return d},s=function(){var n;return null!==(n=d.at(-2))&&void 0!==n?n:null},v=function(n){var t;return(null===(t=f().at(-1))||void 0===t?void 0:t._sid)===n},p=function(n){return!!d.find((function(t){return t._sid===n}))},w=function(n){p(n._sid)||d.push(n)},m=function(){d.pop()},h=function(n,t){if(n||t){var r=y(n,t),i=r.data,o=r.url;window.history.pushState(i,"",o)}};function y(n,t,r){void 0===r&&(r=!1);var i,o,e,u,l=new URLSearchParams(window.location.search);return n&&(l=function(n,t){for(var r in n.delete("modal"),t.params)n.delete(r);return n}(l,n)),t&&!r&&(l=function(n,t){var r=a({modal:t.id},t.params);for(var i in r)n.append(i,r[i].toString());return n}(l,t)),{url:(i=l,o=window.location.pathname.toString(),e=i.toString()?"?"+i.toString():"",u=window.location.hash.toString()?"#"+window.location.hash.toString():"",""+o+e+u),data:{modals:f()}}}var g={},O=function(n,t){g[n]=t},_=[],S=function(n,t){if(!_.find((function(n){return n._sid===t})))return _.push({id:n,_sid:t})},b=function(n){var t;if(v(n)){var r=null!==(t=d.at(-1))&&void 0!==t?t:null,i=s();m(),h(r,i),c()}},E=function(){var n,t,r=null!==(n=window.history.state.modals)&&void 0!==n?n:[],i=f();if(1===Math.abs(r.length-i.length)){var o=Math.min(r.length,i.length),e=null!==(t=r.slice(o).at(-1))&&void 0!==t?t:null;e?w(e):m()}c()},j=function(){var n=function(){var n=new URLSearchParams(window.location.search),t=Object.fromEntries(n.entries()),r=t.modal,i=function(n,t){var r={};for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&t.indexOf(i)<0&&(r[i]=n[i]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(n);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(n,i[o])&&(r[i[o]]=n[i[o]])}return r}(t,["modal"]);if(!r)return null;return{id:"".concat(r),params:i,_sid:L()}}();n&&(w(n),S(n.id,n._sid),function(n,t){if(n||t){var r=y(n,t,!0),i=r.data,o=r.url;window.history.replaceState(a(a({},window.history.state),i),"",o)}}(null,n),c())};function L(){return Math.floor(1e6*Math.random())}var P=t(void 0),x=function(){var t=r(!1),e=i((function(n){return n+1}),0)[1],l=f();o((function(){return window.addEventListener(u,e),window.addEventListener("popstate",E),function(){window.removeEventListener(u,e),window.removeEventListener("popstate",E)}}),[]),o((function(){t.current||(j(),t.current=!0)}),[]);var c=_.map((function(t){var r=function(n){var t;return null!==(t=g[n])&&void 0!==t?t:null}(t.id);if(!r)return null;var i=l.find((function(n){return n._sid===t._sid}));return n(r,{close:function(){var n;b(t._sid),null===(n=null==i?void 0:i.onClose)||void 0===n||n.call(i)},opened:!!i,params:null==i?void 0:i.params},t._sid)}));return n(P.Provider,a({value:void 0},{children:c}))},M=function(n){var t=i((function(n){return n+1}),0)[1],a=r(L());return o((function(){var r=a.current;return S(n,r),window.addEventListener(u,t),function(){!function(n){_.filter((function(t){return t._sid!==n}))}(r),window.removeEventListener(u,t)}}),[]),{open:e((function(t){!function(n){w(n),h(s(),n),c()}({id:n,params:null==t?void 0:t.params,onClose:null==t?void 0:t.onClose,_sid:a.current})}),[n]),closeActive:e((function(){b(a.current)}),[]),isActive:v(a.current),isOpened:p(a.current)}};export{x as ModalsProvider,O as registerModal,M as useModal};
//# sourceMappingURL=index.js.map
