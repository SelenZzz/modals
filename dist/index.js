import{jsx as n,jsxs as t}from"react/jsx-runtime";import{createContext as r,useRef as o,useReducer as e,useEffect as i}from"react";var a=function(){return a=Object.assign||function(n){for(var t,r=1,o=arguments.length;r<o;r++)for(var e in t=arguments[r])Object.prototype.hasOwnProperty.call(t,e)&&(n[e]=t[e]);return n},a.apply(this,arguments)};var u=new Event("activemodalupdate"),c=function(){dispatchEvent(u)},l=[],d=function(){return l},f=function(n){return!!l.findLast((function(t){return t._sid===n}))},s=function(n){f(n._sid)||l.push(n)};function v(n,t){var r,o,e,i,u=new URLSearchParams(window.location.search);return n&&(u=function(n,t){for(var r in n.delete("modal"),t.params)n.delete(r);return n}(u,n)),t&&(u=function(n,t){var r=a({modal:t.id},t.params);for(var o in r)n.append(o,r[o].toString());return n}(u,t)),{url:(r=u,o=window.location.pathname.toString(),e=r.toString()?"?"+r.toString():"",i=window.location.hash.toString()?"#"+window.location.hash.toString():"",""+o+e+i),data:{modals:d()}}}var p=function(n){var t;s(n),function(n,t){if(n||t){var r=v(n,t),o=r.data,e=r.url;window.history.pushState(o,"",e)}}(null!==(t=l.at(-2))&&void 0!==t?t:null,n),c()},w=function(){window.history.back()},h=function(){var n,t,r=null!==(n=window.history.state.modals)&&void 0!==n?n:[],o=d();if(1===Math.abs(r.length-o.length)){var e=Math.min(r.length,o.length),i=null!==(t=r.slice(e).at(-1))&&void 0!==t?t:null;i?s(i):l.pop()}c()},m=function(){var n=function(){var n=new URLSearchParams(window.location.search),t=Object.fromEntries(n.entries()),r=t.modal,o=function(n,t){var r={};for(var o in n)Object.prototype.hasOwnProperty.call(n,o)&&t.indexOf(o)<0&&(r[o]=n[o]);if(null!=n&&"function"==typeof Object.getOwnPropertySymbols){var e=0;for(o=Object.getOwnPropertySymbols(n);e<o.length;e++)t.indexOf(o[e])<0&&Object.prototype.propertyIsEnumerable.call(n,o[e])&&(r[o[e]]=n[o[e]])}return r}(t,["modal"]);if(!r)return null;return{id:"".concat(r),params:o,_sid:y()}}();n&&(s(n),function(n,t){if(n||t){var r=v(n,t),o=r.data,e=r.url;window.history.replaceState(a(a({},window.history.state),{data:o}),"",e)}}(null,n),c())};function y(){return Math.floor(1e6*Math.random())}var g={},O=function(n,t){g[n]=t},b=r(void 0),S=function(r){var u=r.children,c=o(!1),l=e((function(n){return n+1}),0)[1],f=d();i((function(){return window.addEventListener("activemodalupdate",l),window.addEventListener("popstate",h),function(){window.removeEventListener("activemodalupdate",l),window.removeEventListener("popstate",h)}}),[]),i((function(){c.current||(m(),c.current=!0)}),[]);var s=f.map((function(t,r){var o=function(n){var t;return null!==(t=g[n])&&void 0!==t?t:null}(t.id);return o?n(o,{onClose:function(){return w()},params:t.params},r):null}));return t(b.Provider,a({value:void 0},{children:[u,s]}))},j=function(n){var t=o(y());return{open:function(r){var o=a({id:n,_sid:t.current},r);p(o)},closeActive:function(){w()},isActive:function(){return n=t.current,(null===(r=d().at(-1))||void 0===r?void 0:r._sid)===n;var n,r},isOpened:function(){return f(t.current)}}};export{S as ModalsProvider,w as closeModal,m as init,p as openModal,O as registerModal,j as useModal};
//# sourceMappingURL=index.js.map
